<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TMO-Matnog — Arrival/Departure</title>

<style>
:root{
  --bg:#0b1620;
  --panel:#12202a;
  --header:#0e1823;
  --accent:#1f8ef1;
  --muted:#9fb0bd;
  --white:#eaf2f8;
  --loading:#2ad36a;
  --unloading:#2b9be6;
  --standby:#f2c94c;
  --standby-dep:#ff9a43;
  --anchorage:#6b7280;
}

html, body {
  height: 100%;
  margin: 0;
  background: var(--bg);
  color: var(--white);
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
}

header {
  background: var(--header);
  padding: 14px 18px;
  border-bottom: 3px solid var(--accent);
  display: flex;
  align-items: center;
}

header h1 {
  margin: 0;
  color: var(--accent);
  font-size: 1.2rem;
}

main {
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  height: calc(100% - 74px);
  box-sizing: border-box;
}

.panel {
  background: var(--panel);
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  display: flex;
  flex-direction: column;
}

.title {
  background: var(--header);
  padding: 10px 14px;
  color: var(--accent);
  font-weight: 700;
  text-transform: uppercase;
  display: flex;
  justify-content: space-between;
}

.content {
  padding: 8px 10px;
  overflow: auto;
}

/* Table styling with vertical lines */
table {
  width: 100%;
  border-collapse: collapse;
  border-left: 1px solid rgba(255,255,255,0.05);
}

thead th.ramp-col {
  padding: 10px 8px;       /* same as other headers */
  text-align: center;      /* center aligned */
  font-weight: 700;        /* same weight */
  font-size: 0.9rem;       /* match others */
  text-transform: uppercase;
  color: #fff;             /* white text */
  background: var(--accent);
  border-right: 1px solid rgba(255,255,255,0.1);
}

thead th {
  padding: 10px 8px;
  text-align: center;
  font-weight: 700;
  font-size: 0.9rem;
  text-transform: uppercase;
  background: var(--accent);
  color: #fff;
  border-right: 1px solid rgba(255,255,255,0.1);
}

tbody td {
  padding: 12px 8px;
  text-align: center;
  font-size: 1rem;
  border-bottom: 1px solid rgba(255,255,255,0.03);
  border-right: 1px solid rgba(255,255,255,0.05);
}

tbody td:last-child, thead th:last-child {
  border-right: none;
}

tbody tr:nth-child(odd) {
  background: rgba(255,255,255,0.01);
}

/* Ramp / Status styles */
.ramp-col {

  width: 84px;
  font-weight: 800;
  color: #fff; /* make text white */

}

.status {
  display: inline-block;
  padding: 8px 12px;
  border-radius: 999px;
  font-weight: 700;
  color: #071018;
  min-width: 120px;
  text-align: center;
}

.status.loading {
  background: var(--loading);
  animation: flashLoading 1.2s linear infinite;
}

.status.un-loading {
  background: var(--unloading);
}

.status.standby-load {
  background: var(--standby);
}

.status.standby-depart {
  background: var(--standby-dep);
}

.status.anchorage {
  background: var(--anchorage);
  color: #fff;
  opacity: .92;
}

@keyframes flashLoading {
  0%, 100% { opacity: 1; }
  50% { opacity: .35; }
}

footer {
  padding: 8px 12px;
  text-align: center;
  color: var(--muted);
  font-size: .9rem;
  background: var(--header);
  border-top: 2px solid var(--accent);
}
</style>
</head>
<body>

<header>
  <h1>TMO-Matnog — Arrival/Departure</h1>
</header>

<main>
  <section class="panel">
    <div class="title">
      Active Vessels at Berth
      <span id="lastUpdated">—</span>
    </div>
    <div class="content">
      <table>
        <thead>
          <tr>
            <th class="ramp-col">Ramp Num</th>
            <th>Vessel</th>
            <th>Shipping Lines</th>
            <th>Last Port</th>
            <th>Next Port</th>
            <th>ETA</th>
            <th>ETD</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="activeBody">
          <tr><td colspan="8" style="opacity:.6">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <section class="panel">
    <div class="title">Incoming Vessels</div>
    <div class="content">
      <table>
        <thead>
          <tr>
            <th>Vessel</th>
            <th>Shipping Lines</th>
            <th>Origin</th>
            <th>Destination</th>
            <th>ETA</th>
          </tr>
        </thead>
        <tbody id="incomingBody">
          <tr><td colspan="5" style="opacity:.6">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </section>
</main>

<footer>Terminal Management Office of Matnog</footer>

<script>
const oneDriveJSON = "https://raw.githubusercontent.com/reyvincentestayan10-afk/matnog-dashboard/main/dashboard_data.json";

async function fetchJSONData() {
  try {
    const fullURL = `${oneDriveJSON}?nocache=${Date.now()}`;
    const res = await fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(fullURL));
    if (!res.ok) throw new Error("Failed to fetch JSON file");

    const data = await res.json();
    const rampRows = data.latestRampOccupants || [];
    const incomingRows = data.incomingVessels || [];

    updateDashboard(rampRows, incomingRows);

    document.getElementById("lastUpdated").textContent = "Last checked: " + new Date().toLocaleTimeString();
  } catch (err) {
    console.error("Fetch error:", err);
  }
}

function formatTIME(val) {
  if (!val) return "—";
  const digits = val.replace(/\D/g, '');
  if (digits.length < 3) return val;
  let hh = digits.slice(0, digits.length - 2).padStart(2,'0');
  let mm = digits.slice(-2).padStart(2,'0');
  return `${hh}:${mm}`;
}

function updateDashboard(rampRows, incomingRows) {
  const activeBody = document.getElementById("activeBody");
  const incomingBody = document.getElementById("incomingBody");

  activeBody.innerHTML = "";
  incomingBody.innerHTML = "";

  // Active Vessels
  rampRows.forEach(r => {
    const statusClass = r["Status"]?.toLowerCase().replace(/\s+/g,'-') || '';
    const isLoading = r["Status"] === "Loading" ? "loading" : statusClass;
    activeBody.innerHTML += `
      <tr>
        <td class="ramp-col">${r["Ramp Num"] || "—"}</td>
        <td>${r["Vessel Name"] || "—"}</td>
        <td>${r["Shipping Lines"] || "—"}</td>
        <td>${r["Last Port"] || "—"}</td>
        <td>${r["Next Port"] || "—"}</td>
        <td>${formatTIME(r["ETA"])}</td>
        <td>${formatTIME(r["ETD"])}</td>
        <td><span class="status ${isLoading}">${r["Status"] || "—"}</span></td>
      </tr>`;
  });

  // Incoming Vessels
  incomingRows.forEach(r => {
    incomingBody.innerHTML += `
      <tr>
        <td>${r["Vessel Name"] || "—"}</td>
        <td>${r["Shipping Lines"] || "—"}</td>
        <td>${r["Last Port"] || "—"}</td>
        <td>${r["Next Port"] || "—"}</td>
        <td>${formatTIME(r["ETA"])}</td>
      </tr>`;
  });
}

fetchJSONData();
setInterval(fetchJSONData, 10000); // refresh every 10s
</script>

</body>
</html>
